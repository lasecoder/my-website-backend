<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutureTechTalent - Business Solutions</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://kit.fontawesome.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://kit.fontawesome.com/a033fa8b24.js" crossorigin="anonymous"></script>
    <style>
        .loading {
            opacity: 0.6;
            position: relative;
        }
        .loading::after {
            content: "Loading...";
            position: absolute;
            left: 0;
            right: 0;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Your existing HTML content -->

    <script>
      // Configuration and DOM elements
      const config = {
        backendUrl: "",
        refreshInterval: 30000,
        defaultContent: {
          header: {
            title: "FutureTechTalent - Professional Business Solutions",
            image: "/images/default-logo.png"
          },
          services: [],
          footer: {
            footerText: "Â© 2025 FutureTechTalent Business Solutions. All Rights Reserved."
          }
        }
      };

      // DOM elements and state
      const elements = {
        headerTitle: document.getElementById("home-header-title"),
        introText: document.getElementById("home-intro-text"),
        servicesText: document.getElementById("home-services-text"),
        logo: document.getElementById("logo"),
        footerText: document.getElementById("home-footer-text"),
        servicesContainer: document.getElementById("services-container")
      };
      
      let refreshTimer;
      let lastUpdateTime = 0;

      // Safe fetch implementation
      async function safeFetch(url) {
        try {
          const response = await fetch(`${url}?t=${Date.now()}`);
          if (!response.ok) throw new Error(`HTTP error ${response.status}`);
          return await response.json();
        } catch (error) {
          console.error('Fetch error:', error);
          throw error;
        }
      }

      // Image handling
      function createImageElement(src, alt, fallback) {
        const img = new Image();
        img.src = src;
        img.alt = alt;
        img.onerror = () => { img.src = fallback; };
        return img;
      }

      // Service card template
      function createServiceCard(service) {
        const card = document.createElement('div');
        card.className = 'service-card';
        
        const title = document.createElement('h2');
        title.className = 'service-title';
        title.textContent = service.title || 'Our Service';
        
        const img = createImageElement(
          service.image || '/images/default-service.jpg',
          service.title || 'Service',
          '/images/default-service.jpg'
        );
        img.className = 'service-image';
        
        const desc = document.createElement('p');
        desc.className = 'service-description';
        desc.textContent = service.description || '';
        
        card.append(title, img, desc);
        return card;
      }

      // Content rendering
      async function renderContent() {
        try {
          const data = await safeFetch('/api/home-content');
          const content = data.data || data;
          
          // Update text content
          elements.headerTitle.textContent = content.header?.title || config.defaultContent.header.title;
          elements.footerText.textContent = content.footer?.footerText || config.defaultContent.footer.footerText;
          
          // Update logo
          const logoImg = createImageElement(
            content.header?.image || config.defaultContent.header.image,
            'Company Logo',
            config.defaultContent.header.image
          );
          elements.logo.replaceWith(logoImg);
          elements.logo = logoImg;
          logoImg.style.display = 'block';
          
          // Render services
          elements.servicesContainer.innerHTML = '';
          const services = Array.isArray(content.services) ? content.services : config.defaultContent.services;
          services.forEach(service => {
            elements.servicesContainer.appendChild(createServiceCard(service));
          });
          
        } catch (error) {
          console.error('Rendering fallback content');
          // Fallback rendering
          elements.headerTitle.textContent = config.defaultContent.header.title;
          elements.footerText.textContent = config.defaultContent.footer.footerText;
          
          const logoImg = createImageElement(
            config.defaultContent.header.image,
            'Company Logo',
            config.defaultContent.header.image
          );
          elements.logo.replaceWith(logoImg);
          elements.logo = logoImg;
          logoImg.style.display = 'block';
          
          elements.servicesContainer.innerHTML = '';
          config.defaultContent.services.forEach(service => {
            elements.servicesContainer.appendChild(createServiceCard(service));
          });
        }
      }

      // Auto-refresh
      function setupAutoRefresh() {
        const refresh = () => {
          renderContent();
          lastUpdateTime = Date.now();
        };
        
        // Initial refresh
        refresh();
        
        // Periodic refresh
        refreshTimer = setInterval(refresh, config.refreshInterval);
        
        // Refresh when tab becomes visible
        document.addEventListener('visibilitychange', () => {
          if (!document.hidden && Date.now() - lastUpdateTime > config.refreshInterval) {
            refresh();
          }
        });
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        setupAutoRefresh();
      });

      // Cleanup
      window.addEventListener('beforeunload', () => {
        clearInterval(refreshTimer);
      });
    </script>
</body>
</html>