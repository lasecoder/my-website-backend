<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutureTechTalent - Business Solutions</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://kit.fontawesome.com/a033fa8b24.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-left">
                <img id="logo" src="https://my-backend-service.onrender.com/uploads/default-logo.png" alt="Company Logo">
            </div>
            <div class="register">
                <button class="btn" onclick="location.href='login.html'">Login</button>
                <button class="btn" onclick="location.href='signup.html'">Sign Up</button>
            </div>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search..." />
                <button onclick="searchFunction()">üîç</button>
            </div>
            <div class="header-right">
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="vacancy.html">Vacancy</a></li>
                        <li><a href="scholars.html">Scholarship</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="about.html">About Us</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Added display sections for content -->
        <section class="intro">
            <div id="header-display"></div>
            <div id="services-display"></div>
            <div id="footer-display"></div>
        </section>

        <!-- Added admin controls (could be hidden for non-admin users) -->
        <div class="admin-controls" style="margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem;">
            <h3>Admin Controls</h3>
            
            <div class="control-group">
                <h4>Update Header</h4>
                <input type="text" id="home-header-title" placeholder="Header title">
                <input type="file" id="home-header-image">
                <button id="update-header-btn">Update Header</button>
            </div>
            
            <div class="control-group">
                <h4>Update Service 1</h4>
                <input type="text" id="service1-title" placeholder="Service title">
                <input type="text" id="service1-description" placeholder="Service description">
                <input type="file" id="service1-image">
                <button id="update-service1-btn">Update Service</button>
            </div>
            
            <div class="control-group">
                <h4>Update Footer</h4>
                <textarea id="home-footer-text" placeholder="Footer text"></textarea>
                <button id="update-footer-btn">Update Footer</button>
            </div>
        </div>

        <section class="contact-cta">
            <h2 id="home-cta-text">Let's Grow Your Business</h2>
            <p>Contact us today to learn how we can help you succeed.</p>
            <a id="home-cta-link" href="contact.html" class="button-primary">Get in Touch</a>
        </section>
        
        <div id="chat-bot">
            <button id="chat-toggle">üí¨ Chat with Us</button>
            <div id="chat-window" style="display: none;">
                <p>Hi there! How can we help you today?</p>
                <input type="text" id="chat-input" placeholder="Type your message...">
                <button id="send-button">Send</button>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <p id="footer-text"></p>
                </div>
            </div>
            <div class="social-media">
                <a href="https://facebook.com" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://twitter.com" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="https://instagram.com" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://linkedin.com" target="_blank"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </footer>

    <script>
        const backendUrl = "https://my-backend-service.onrender.com";

        // Improved fetch and display function
        async function fetchAndDisplayContent(section, elementId) {
            try {
                const response = await fetch(`${backendUrl}/api/${section}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                
                // Handle different response structures
                let content = data.content || data.header || data.footer || data;
                
                const element = document.getElementById(elementId);
                if (!element) {
                    console.error(`Element with ID ${elementId} not found`);
                    return;
                }

                if (section === 'header') {
                    element.innerHTML = `
                        <h2>${content.title || 'Welcome to FutureTechTalent'}</h2>
                        ${content.imageUrl ? `<img src="${backendUrl}${content.imageUrl}" alt="Header Image">` : ''}
                    `;
                } else if (section === 'services') {
                    element.innerHTML = `
                        <h3>${content.title || 'Our Services'}</h3>
                        <p>${content.description || ''}</p>
                        ${content.imageUrl ? `<img src="${backendUrl}${content.imageUrl}" alt="Service Image">` : ''}
                    `;
                } else if (section === 'footer') {
                    document.getElementById('footer-text').textContent = 
                        content.footerText || content.content || '¬© 2025 FutureTechTalent. All rights reserved.';
                }
            } catch (error) {
                console.error(`Error fetching ${section}:`, error);
                // Fallback content
                if (section === 'footer') {
                    document.getElementById('footer-text').textContent = 
                        '¬© 2025 FutureTechTalent. All rights reserved.';
                }
            }
        }

        // Improved update function
        async function updateContent(section, title, description, image = null) {
            try {
                const formData = new FormData();
                
                if (section === "footer") {
                    formData.append("footerText", description);
                } else {
                    if (title) formData.append("title", title);
                    if (description) formData.append("description", description);
                    if (image) formData.append("image", image);
                }

                const response = await fetch(`${backendUrl}/api/${section}`, {
                    method: "POST",
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || "Failed to update content");
                }

                const data = await response.json();
                console.log("Update successful:", data);
                alert(`${section} updated successfully!`);
                fetchAndDisplayContent(section, `${section}-display`);
            } catch (error) {
                console.error("Error updating content:", error);
                alert(`Error: ${error.message}`);
            }
        }

        // Initialize on page load
        document.addEventListener("DOMContentLoaded", function() {
            // Fetch and display all content
            fetchAndDisplayContent('header', 'header-display');
            fetchAndDisplayContent('services', 'services-display');
            fetchAndDisplayContent('footer', 'footer-display');

            // Chat toggle functionality
            document.getElementById('chat-toggle')?.addEventListener('click', function() {
                const chatWindow = document.getElementById('chat-window');
                chatWindow.style.display = chatWindow.style.display === 'none' ? 'block' : 'none';
            });

            // Set up event listeners for update buttons
            document.getElementById('update-header-btn')?.addEventListener('click', () => {
                const title = document.getElementById('home-header-title').value;
                const image = document.getElementById('home-header-image').files[0];
                updateContent('header', title, '', image);
            });

            document.getElementById('update-service1-btn')?.addEventListener('click', () => {
                const title = document.getElementById('service1-title').value;
                const description = document.getElementById('service1-description').value;
                const image = document.getElementById('service1-image').files[0];
                updateContent('services', title, description, image);
            });

            document.getElementById('update-footer-btn')?.addEventListener('click', () => {
                const footerText = document.getElementById('home-footer-text').value;
                updateContent('footer', '', footerText);
            });
        });
    </script>
</body>
</html>